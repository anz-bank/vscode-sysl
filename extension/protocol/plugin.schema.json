{
  "$id": "https://github.com/anz-bank/sysl/vscode-sysl/extension/protocol/request.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "RequestOrResponse",
  "description": "General request wrapper for all specific request and response types.",
  "definitions": {
    "Request": {
      "description": "General wrapper for all responses.",
      "type": "object",
      "properties": {
        "initialize": {
          "$ref": "#/definitions/InitializeRequest"
        },
        "onchange": {
          "$ref": "#/definitions/OnChangeRequest"
        }
      }
    },

    "Response": {
      "description": "General wrapper for all responses.",
      "type": "object",
      "properties": {
        "error": {
          "$ref": "#/definitions/Error"
        },
        "initialize": {
          "$ref": "#/definitions/InitializeResponse"
        },
        "onchange": {
          "$ref": "#/definitions/OnChangeResponse"
        }
      }
    },

    "Error": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer"
        },
        "message": {
          "type": "string"
        },
        "data": {
          "type": "object"
        }
      }
    },

    "InitializeRequest": {
      "type": "object",
      "properties": {
        "capabilities": {
          "type": "object"
        }
      }
    },

    "InitializeResponse": {
      "type": "object",
      "properties": {
        "capabilities": {
          "$ref": "#/definitions/ServerCapabilities"
        }
      }
    },

    "OnChangeRequest": {
      "type": "object",
      "properties": {
        "context": {
          "$ref": "#/definitions/Context"
        },
        "change": {
          "$ref": "#/definitions/Change"
        }
      }
    },

    "OnChangeResponse": {
      "type": "object",
      "properties": {
        "renderDiagram": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Diagram"
          }
        }
      }
    },

    "Context": {
      "type": "object",
      "properties": {
        "filePath": {
          "description": "The path to the client's currently focused file.",
          "type": "string"
        },
        "fileContent": {
          "description": "The content of the focused file.",
          "type": "string"
        },
        "module": {
          "description": "The Sysl module encoded in the focused file.",
          "$ref": "#/definitions/Module"
        },
        "syslRoot": {
          "description": "The path to the Sysl root.",
          "type": "string"
        },
        "focus": {
          "description": "The specific position on which the client is focused.",
          "$ref": "#/definitions/Position"
        },
        "settings": {
          "description": "The state of relevant settings in the client.",
          "$ref": "#/definitions/Settings"
        },
        "viewId": {
          "description": "The ID of the view where the change occurred.",
          "type": "string"
        }
      }
    },

    "Module": {
      "type": "string",
      "contentEncoding": "base64",
      "contentMediaType": "application/sysl"
    },

    "Settings": {
      "type": "object",
      "properties": {}
    },

    "Position": {
      "type": "object",
      "description": "A position within a Sysl spec.",
      "properties": {
        "src": {
          "type": "string"
        },
        "app": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "type": {
          "type": "string"
        },
        "field": {
          "type": "string"
        },
        "anno": {
          "type": "string"
        },
        "tag": {
          "type": "string"
        },
        "endpoint": {
          "type": "string"
        },
        "stmt": {
          "type": "string"
        },
        "param": {
          "type": "string"
        }
      }
    },

    "ClientCapabilities": {
      "type": "object",
      "properties": {}
    },

    "ServerCapabilities": {
      "type": "object",
      "properties": {
        "diagrams": {
          "$ref": "#/definitions/DiagramCapabilities"
        }
      }
    },

    "DiagramDescriptor": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "icon": {
          "type": "string"
        }
      }
    },

    "DiagramCapabilities": {
      "type": "object",
      "properties": {
        "availabilities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "object",
                "$ref": "#/definitions/DiagramDescriptor"
              },
              "available": {
                "description": "Whether this diagram type is available from this plugin.",
                "type": "boolean"
              },
              "reason": {
                "description": "If not available, the reason why.",
                "type": "string"
              }
            }
          }
        }
      }
    },

    "Diagram": {
      "type": "object",
      "properties": {
        "type": {
          "type": "object",
          "$ref": "#/definitions/DiagramDescriptor"
        },
        "content": {
          "$ref": "#/definitions/DiagramData"
        }
      }
    },

    "Change": {
      "type": "object",
      "description": "Represents a single change to a single file in the client that the plugin may react to.",
      "properties": {
        "source": {
          "description": "The surface in the client where the change originated.",
          "$ref": "#/definitions/Source"
        },
        "action": {
          "description": "The action that caused the change.",
          "$ref": "#/definitions/Action"
        },
        "filePath": {
          "description": "The path to the file that changed.",
          "type": "string"
        },
        "detail": {
          "type": "object"
        }
      }
    },

    "Source": {
      "enum": ["UNSPECIFIED_SOURCE", "TEXT", "DIAGRAM", "CUSTOM"]
    },

    "Action": {
      "enum": [
        "UNSPECIFIED_ACTION",
        "ADD",
        "MODIFY",
        "REMOVE",
        "CREATE_FILE",
        "SAVE_FILE",
        "DELETE_FILE"
      ]
    },

    "DiagramData": {
      "type": "object",
      "description": "The content of a diagram.",
      "properties": {
        "nodes": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Node"
          }
        },
        "edges": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/Edge"
          }
        },
        "templates": { "$ref": "#/definitions/TemplateData" }
      }
    },

    "Node": {
      "type": "object"
    },

    "Edge": {
      "type": "object"
    },

    "TemplateData": {
      "type": "object",
      "properties": {
        "diagramLabel": { "type": "string" },
        "diagramLayout": { "$ref": "#/definitions/TemplateLayoutData" },
        "nodes": {
          "type": "object",
          "additionalProperties": { "$ref": "#/definitions/TemplateNodeData" }
        },
        "groups": {
          "type": "object",
          "additionalProperties": { "$ref": "#/definitions/TemplateGroupData" }
        },
        "edges": {
          "type": "object",
          "additionalProperties": { "$ref": "#/definitions/TemplateEdgeData" }
        }
      }
    },

    "TemplateLayoutData": {
      "type": "object",
      "properties": {}
    },

    "TemplateNodeData": {
      "type": "object",
      "properties": {
        "shadow": { "$ref": "#/definitions/TemplateShadowData" },
        "sections": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/TemplateSectionData"
          }
        }
      }
    },

    "TemplateGroupData": {
      "type": "object",
      "properties": {
        "shadow": { "$ref": "#/definitions/TemplateShadowData" },
        "expanded": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/TemplateSectionData"
          }
        },
        "collapsed": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/TemplateSectionData"
          }
        }
      }
    },

    "TemplateEdgeData": {
      "type": "object",
      "properties": {
        "corner": {
          "type": "integer"
        },
        "pathShape": { "$ref": "#/definitions/TemplateShape" },
        "arrowShape": { "$ref": "#/definitions/TemplateShape" },
        "text": { "$ref": "#/definitions/TemplateTextBlock" }
      }
    },

    "TemplateShadowData": {
      "type": "object",
      "properties": {
        "shadowOffset": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "shadowBlur": { "type": "integer" },
        "shadowColor": { "type": "string" }
      }
    },

    "TemplateSectionData": {
      "type": "object",
      "properties": {
        "panelType": { "type": "string" },
        "desiredSize": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "background": {
          "type": "string"
        },
        "mainPanel": {
          "type": "boolean"
        },
        "height": {
          "type": "integer"
        },
        "padding": {
          "type": "integer"
        },
        "stretch": {
          "type": "boolean"
        },
        "minSize": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "width": {
          "type": "integer"
        },
        "shape": { "$ref": "#/definitions/TemplateShape" },
        "text": { "$ref": "#/definitions/TemplateTextBlock" },
        "sections": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/TemplateSectionData"
          }
        }
      }
    },

    "TemplateShape": {
      "type": "object",
      "properties": {
        "shapeType": {
          "type": "string"
        },
        "fill": {
          "type": "string"
        },
        "strokeWidth": {
          "type": "integer"
        },
        "stroke": {
          "type": "string"
        },
        "toArrow": {
          "type": "string"
        }
      }
    },

    "TemplateTextBlock": {
      "type": "object",
      "properties": {
        "align": {
          "enum": ["start", "end", "left", "right", "center"]
        },
        "font": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "margin": {
          "type": "string"
        },
        "maxLines": {
          "type": "integer"
        },
        "stroke": {
          "type": "string"
        },
        "stretch": {
          "type": "boolean"
        },
        "segmentOffset": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        }
      }
    }
  },

  "oneOf": [
    {
      "$ref": "#/definitions/Request"
    },
    {
      "$ref": "#/definitions/Response"
    }
  ]
}
